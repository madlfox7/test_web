server {
  listen 80;
  server_name _;

  # 1) Все корневые запросы проксируем на Node (SPA)
  location / {
    proxy_pass http://psyaid_node:3000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # 2) API на PHP: /api/*.php -> php-fpm
  # используя alias, чтобы файлы лежали прямо в /php
  location ~ ^/api/(.+\.php)$ {
    alias /var/www/html/$1;
    include fastcgi_params;
    fastcgi_param SCRIPT_FILENAME /var/www/html/$1;
    fastcgi_pass psyaid_php:9000;
  }

  # 3) Отдача статических ресурсов из /public (иконки, css, js, изображения)
  location ~* \.(?:js|css|png|jpg|jpeg|gif|svg|ico|webp|woff2?)$ {
    root /var/www/public;
    access_log off;
    expires 7d;
    add_header Cache-Control "public";
    try_files $uri =404;
  }
}
