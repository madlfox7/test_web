<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>–î–µ–º–æ Cookie: –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è, —Ç–µ–º–∞ –∏ –∏–º—è</title>
<style>
  :root {
    --bg-dark:#0f172a; --card-dark:#111827; --text-dark:#e5e7eb;
    --bg-light:#f9fafb; --card-light:#ffffff; --text-light:#111827;
    --muted-dark:#9ca3af; --muted-light:#6b7280;
  }
  * { box-sizing:border-box; transition:background .25s,color .25s; }
  body { margin:0; font:16px/1.5 system-ui,Segoe UI,Roboto; background:var(--bg-dark); color:var(--text-dark) }
  body.light { background:var(--bg-light); color:var(--text-light) }
  .wrap { max-width:920px; margin:auto; padding:32px 16px }
  h1 { font-size:clamp(22px,2.6vw,32px); margin:0 0 8px }
  .lead { color:var(--muted-dark); margin:0 0 20px }
  body.light .lead { color:var(--muted-light) }
  .grid { display:grid; gap:16px; grid-template-columns:1.3fr 1fr }
  .card { background:rgba(17,24,39,.8); border:1px solid rgba(148,163,184,.18); border-radius:16px; padding:18px; backdrop-filter:blur(6px) }
  body.light .card { background:var(--card-light); border-color:rgba(0,0,0,.1) }
  .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap }
  .badge { display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; background:#111827; border:1px solid rgba(148,163,184,.2); color:#cbd5e1 }
  body.light .badge { background:#f3f4f6; border-color:rgba(0,0,0,.1); color:#111827 }
  .btn { border:1px solid rgba(148,163,184,.35); background:#0b1224; color:#e5e7eb; padding:10px 14px; border-radius:10px; cursor:pointer }
  .btn.primary { background:linear-gradient(180deg,#2563eb,#1d4ed8); border-color:#1d4ed8 }
  .btn.ghost { background:transparent }
  .btn.danger { border-color:#ef4444; color:#fecaca }
  select, input[type=text] {
    padding:10px 12px; border-radius:10px; border:1px solid rgba(148,163,184,.35); background:#0b1224; color:#e5e7eb
  }
  body.light select, body.light input[type=text] { background:#f9fafb; color:#111827 }
  .ad { display:grid; place-items:center; min-height:220px; border-radius:14px; border:1px dashed rgba(148,163,184,.35); text-align:center; padding:14px }
  .muted { color:var(--muted-dark) }
  body.light .muted { color:var(--muted-light) }
  .kvs { font-size:14px; color:#94a3b8 }
  body.light .kvs { color:#6b7280 }
  .hr { height:1px; background:linear-gradient(90deg,transparent,rgba(148,163,184,.35),transparent); margin:14px 0 }
  .hello { margin:8px 0 12px; font-weight:600 }
  @media (max-width:900px){ .grid{ grid-template-columns:1fr } }
  
</style>
</head>
<body>
<div class="wrap">
  <h1>üç™ –î–µ–º–æ cookie: –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è, —Ç–µ–º–∞ –∏ –∏–º—è</h1>
  <p class="lead">Cookie ‚Äî –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ; –±–µ–∑ cookie ‚Äî –≤ —Ä–∞–º–∫–∞—Ö –≤–∫–ª–∞–¥–∫–∏/—Å–µ–∞–Ω—Å–∞. –ò–º—è –≤–∏–¥–Ω–æ —Å—Ä–∞–∑—É, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å —Å–æ–≥–ª–∞—Å–∏—è.</p>

  <div class="grid">
    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
    <section class="card">
      <div class="row" style="justify-content:space-between">
        <div class="badge">–°–æ–≥–ª–∞—Å–∏–µ: <b id="consentState">–Ω–µ –∑–∞–¥–∞–Ω–æ</b></div>
        <div class="row">
          <button class="btn primary" id="btnAllow">–†–∞–∑—Ä–µ—à–∏—Ç—å cookie</button>
          <button class="btn ghost" id="btnDeny">–ó–∞–ø—Ä–µ—Ç–∏—Ç—å</button>
          <button class="btn danger" id="btnReset">–°–±—Ä–æ—Å–∏—Ç—å –¥–µ–º–æ</button>
        </div>
      </div>

      <div class="hr"></div>

      <div class="row">
        <label for="name">–ò–º—è –¥–ª—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è:</label>
        <input id="name" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è"/>
      </div>

      <div class="hr"></div>

      <div class="row">
        <label for="category">–ò–Ω—Ç–µ—Ä–µ—Å—ã (—Ä–µ–∫–ª–∞–º–∞):</label>
        <select id="category">
          <option value="travel">–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</option>
          <option value="sport">–°–ø–æ—Ä—Ç</option>
          <option value="tech">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</option>
          <option value="mind">–û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å</option>
        </select>
      </div>

      <div class="hr"></div>

      <div class="row">
        <label for="theme">–¢–µ–º–∞ —Å–∞–π—Ç–∞:</label>
        <select id="theme">
          <option value="dark">–¢—ë–º–Ω–∞—è</option>
          <option value="light">–°–≤–µ—Ç–ª–∞—è</option>
        </select>
      </div>

      <p class="kvs">
        Cookie: <code>consent</code>, <code>ad_cat</code>, <code>theme</code>, <code>name</code> (–ø—Ä–∏ —Å–æ–≥–ª–∞—Å–∏–∏).<br/>
        –ë–µ–∑ cookie: —Ä–µ–∫–ª–∞–º–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ <code>sessionStorage.ad_cat_ss</code>, –∏–º—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è.
      </p>
    </section>

    <!-- –í–∏—Ç—Ä–∏–Ω–∞ —Ä–µ–∫–ª–∞–º—ã -->
    <section class="card">
      <div class="badge">ü™ß –†–µ–∫–ª–∞–º–Ω—ã–π —Å–ª–æ—Ç</div>
      <div class="hello" id="hello" aria-live="polite">–ü—Ä–∏–≤–µ—Ç!</div>
      <div class="ad" id="adSlot"></div>
      <p class="kvs" id="debug"></p>
    </section>
  </div>

  <div class="hr"></div>
  
  


<script>
/* ---------- cookie helpers ---------- */
function escapeName(n){ return n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,'\\$&'); }
function setCookie(name, value, days){
  const d = new Date(); d.setTime(d.getTime() + (days*24*60*60*1000));
  const expires = "expires="+ d.toUTCString();
  const secure = location.protocol === "https:" ? "; Secure" : "";
  document.cookie = `${name}=${encodeURIComponent(value)}; ${expires}; path=/; SameSite=Lax${secure}`;
}
function getCookie(name){
  const m = document.cookie.match(new RegExp('(?:^|; )'+escapeName(name)+'=([^;]*)'));
  return m ? decodeURIComponent(m[1]) : null;
}
function delCookie(name){
  const secure = location.protocol === "https:" ? "; Secure" : "";
  document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/; SameSite=Lax${secure}`;
}

/* ---------- –∫–∞—Ç–∞–ª–æ–≥ —Ä–µ–∫–ª–∞–º—ã ---------- */
const ads = {
  travel:{emoji:"üèùÔ∏è",title:"–¢—É—Ä—ã ‚àí20%",text:"–°—Ç–∞–º–±—É–ª, –¢–±–∏–ª–∏—Å–∏, –î—É–±–∞–π ‚Äî –º–µ—á—Ç—ã —Ä—è–¥–æ–º."},
  sport:{emoji:"üèÉ",title:"–ö—Ä–æ—Å—Å–æ–≤–∫–∏ ProRun",text:"–õ–µ–≥—á–µ –Ω–∞ 30% ‚Äî –±—ã—Å—Ç—Ä–µ–µ –∫–∞–∂–¥—ã–π –∫–º."},
  tech:{emoji:"üíª",title:"Nova 14",text:"–¢–æ–Ω–∫–∏–π, —Ç–∏—Ö–∏–π, 18 —á–∞—Å–æ–≤ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç–∏."},
  mind:{emoji:"üßò",title:"CalmYou",text:"–ú–µ–¥–∏—Ç–∞—Ü–∏–∏ –∏ –¥—ã—Ö–∞–Ω–∏–µ 4‚Äì7‚Äì8."}
};

const el = {
  consent: document.getElementById('consentState'),
  ad: document.getElementById('adSlot'),
  dbg: document.getElementById('debug'),
  cat: document.getElementById('category'),
  theme: document.getElementById('theme'),
  name: document.getElementById('name'),
  hello: document.getElementById('hello')
};

function getConsent(){ return getCookie('consent'); }

/* ----- —Ä–µ–∫–ª–∞–º–∞: cookie –∏–ª–∏ sessionStorage ----- */
function getAdCat(){
  return getConsent()==='1' ? getCookie('ad_cat') : sessionStorage.getItem('ad_cat_ss');
}
function setAdCat(v){
  if (getConsent()==='1') setCookie('ad_cat', v, 365);
  else sessionStorage.setItem('ad_cat_ss', v);
}
function clearAdCat(){
  delCookie('ad_cat'); sessionStorage.removeItem('ad_cat_ss');
}

/* ----- –∏–º—è: –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Å–µ–≥–¥–∞, —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ —Å consent=1 ----- */
function updateHelloDisplay(srcVal){
  const name = (srcVal ?? el.name.value ?? '').trim();
  el.hello.textContent = name ? `–ü—Ä–∏–≤–µ—Ç, ${name}!` : '–ü—Ä–∏–≤–µ—Ç!';
}
function loadName(){
  const saved = getConsent()==='1' ? getCookie('name') : null;
  if (saved) el.name.value = saved;
  updateHelloDisplay(saved ?? el.name.value);
}
function maybePersistName(){
  const v = (el.name.value || '').trim();
  if (getConsent()==='1') { v ? setCookie('name', v, 365) : delCookie('name'); }
  updateHelloDisplay(v); // –≤—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ–º UI
}

/* ----- –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏ –≤—ã–¥–∞—á–µ —Å–æ–≥–ª–∞—Å–∏—è ----- */
function migrateSessionToCookiesOnConsent(){
  if (getConsent()!=='1') return;
  // ad category: –ø–µ—Ä–µ–Ω–æ—Å–∏–º, –µ—Å–ª–∏ cookie –µ—â—ë –Ω–µ—Ç
  const ssCat = sessionStorage.getItem('ad_cat_ss');
  if (ssCat && !getCookie('ad_cat')) setCookie('ad_cat', ssCat, 365);
  // theme: —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π –≤—ã–±–æ—Ä –∏–∑ —Å–µ–ª–µ–∫—Ç–∞
  const t = el.theme.value;
  if (t) setCookie('theme', t, 365);
  // name: –µ—Å–ª–∏ –ø–æ–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
  const n = (el.name.value || '').trim();
  if (n) setCookie('name', n, 365);
}

/* ----- –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–Ω–¥–µ—Ä ----- */
function render(){
  const consent = getConsent();
  const cat = getAdCat();
  const theme = getCookie('theme');

  // –¢–µ–º–∞: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ consent=1
  const effectiveTheme = (consent==='1' && theme==='light') ? 'light' : 'dark';
  document.body.classList.toggle('light', effectiveTheme==='light');
  el.theme.value = effectiveTheme;

  // –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ–≥–ª–∞—Å–∏—è
  el.consent.textContent = consent==='1' ? '—Ä–∞–∑—Ä–µ—à–µ–Ω–æ' : (consent==='0' ? '–∑–∞–ø—Ä–µ—â–µ–Ω–æ' : '–Ω–µ –∑–∞–¥–∞–Ω–æ');

  // –†–µ–∫–ª–∞–º–∞
  if (cat && ads[cat]){
    const a = ads[cat];
    el.ad.innerHTML = `<div><div style="font-size:42px">${a.emoji}</div><h3>${a.title}</h3><p class="muted">${a.text}</p>
      <p class="kvs">–ò—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è: <code>${consent==='1' ? 'cookie: ad_cat' : 'sessionStorage: ad_cat_ss'}</code></p></div>`;
    el.cat.value = cat;
  } else {
    el.ad.innerHTML = `<div><div class="muted">–ù–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏</div><h3>–í—ã –∑–¥–µ—Å—å –≤–ø–µ—Ä–≤—ã–µ?</h3><p class="muted">–û–±—â–∏–π –±–∞–Ω–Ω–µ—Ä –±–µ–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.</p></div>`;
    // —Å–±—Ä–æ—Å —Å–µ–ª–µ–∫—Ç–∞ –∫ –ø–µ—Ä–≤–æ–º—É –ø—É–Ω–∫—Ç—É, –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ
    el.cat.value = el.cat.querySelector('option')?.value || 'travel';
  }

  // –ò–º—è
  loadName();

  // Debug
  el.dbg.textContent = "Cookies: " + (document.cookie || "(–ø—É—Å—Ç–æ)") +
    " | sessionStorage.ad_cat_ss: " + (sessionStorage.getItem('ad_cat_ss') ?? "(–ø—É—Å—Ç–æ)");
}

/* ----- –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ ----- */
document.getElementById('btnAllow').onclick = ()=>{
  setCookie('consent','1',365);
  migrateSessionToCookiesOnConsent(); // –ø–µ—Ä–µ–Ω–µ—Å—ë–º –≤—ã–±–æ—Ä—ã –∏–∑ —Å–µ—Å—Å–∏–∏
  render();
};
document.getElementById('btnDeny').onclick  = ()=>{
  setCookie('consent','0',365);
  clearAdCat(); delCookie('theme'); delCookie('name');
  render();
};
// –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ä–∞–∑—É –ø–æ –≤—ã–±–æ—Ä—É –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
el.cat.addEventListener('change', ()=>{ setAdCat(el.cat.value); render(); });

// –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º—ã —Å—Ä–∞–∑—É –ø–æ –≤—ã–±–æ—Ä—É
el.theme.addEventListener('change', ()=>{
  const v = el.theme.value;
  if (getConsent()==='1') setCookie('theme', v, 365);
  document.body.classList.toggle('light', v==='light'); // –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
  // –ù–∞ —Å–ª–µ–¥—É—é—â–µ–º render —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–∫—Ä–µ–ø–∏—Ç—Å—è —Å —É—á—ë—Ç–æ–º consent
});
el.name.addEventListener('input', maybePersistName);

document.getElementById('btnReset').onclick = ()=>{
  ['consent','ad_cat','theme','name'].forEach(delCookie);
  sessionStorage.removeItem('ad_cat_ss');
  el.name.value = '';
  render();
};

render();
</script>
 
</body>
</html>
