<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>–î–µ–º–æ Cookie: –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Ç–µ–º–∞</title>
<style>
  :root {
    --bg-dark:#0f172a; --card-dark:#111827; --text-dark:#e5e7eb;
    --bg-light:#f9fafb; --card-light:#ffffff; --text-light:#111827;
    --accent:#60a5fa; --muted-dark:#9ca3af; --muted-light:#6b7280;
  }
  * { box-sizing:border-box; transition:background .3s,color .3s; }
  body { margin:0; font:16px/1.5 system-ui,Segoe UI,Roboto; background:var(--bg-dark); color:var(--text-dark); }
  body.light { background:var(--bg-light); color:var(--text-light); }
  .wrap { max-width:920px; margin:auto; padding:32px 16px }
  h1 { font-size:clamp(22px,2.6vw,32px); margin:0 0 8px }
  p.lead { color:var(--muted-dark); margin:0 0 20px }
  body.light p.lead { color:var(--muted-light); }
  .grid { display:grid; gap:16px; grid-template-columns:1.3fr 1fr }
  .card { background:rgba(17,24,39,.8); border:1px solid rgba(148,163,184,.18); border-radius:16px; padding:18px; backdrop-filter:blur(6px) }
  body.light .card { background:var(--card-light); border-color:rgba(0,0,0,.1) }
  .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap }
  .badge { display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; background:#111827; border:1px solid rgba(148,163,184,.2); color:#cbd5e1 }
  body.light .badge { background:#f3f4f6; border-color:rgba(0,0,0,.1); color:#111827 }
  .btn { border:1px solid rgba(148,163,184,.35); background:#0b1224; color:#e5e7eb; padding:10px 14px; border-radius:10px; cursor:pointer }
  .btn.primary { background:linear-gradient(180deg,#2563eb,#1d4ed8); border-color:#1d4ed8 }
  .btn.ghost { background:transparent }
  .btn.danger { border-color:#ef4444; color:#fecaca }
  select { padding:10px 12px; border-radius:10px; border:1px solid rgba(148,163,184,.35); background:#0b1224; color:#e5e7eb }
  body.light select { background:#f9fafb; color:#111827 }
  .ad { display:grid; place-items:center; min-height:220px; border-radius:14px; border:1px dashed rgba(148,163,184,.35); text-align:center; padding:14px }
  .muted { color:var(--muted-dark) }
  body.light .muted { color:var(--muted-light) }
  .kvs { font-size:14px; color:#94a3b8 }
  body.light .kvs { color:#6b7280 }
  .hr { height:1px; background:linear-gradient(90deg,transparent,rgba(148,163,184,.35),transparent); margin:14px 0 }
  @media (max-width:900px){ .grid{ grid-template-columns:1fr } }
</style>
</head>
<body>
<div class="wrap">
  <h1>üç™ –î–µ–º–æ cookie-–ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —Ç–µ–º—ã</h1>
  <p class="lead">
    Cookie ‚á¢ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è –ø–∞–º—è—Ç—å. <b>–ë–µ–∑ cookie</b> ‚Äî —Ä–µ–∫–ª–∞–º–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –≤ —Ä–∞–º–∫–∞—Ö –≤–∫–ª–∞–¥–∫–∏ —á–µ—Ä–µ–∑ <code>sessionStorage</code>, —Ç–µ–º–∞ ‚Äî —Ç–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–Ω–æ (–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è).
  </p>

  <div class="grid">
    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
    <section class="card">
      <div class="row" style="justify-content:space-between">
        <div class="badge">–°–æ–≥–ª–∞—Å–∏–µ: <b id="consentState">–Ω–µ –∑–∞–¥–∞–Ω–æ</b></div>
        <div class="row">
          <button class="btn primary" id="btnAllow">–†–∞–∑—Ä–µ—à–∏—Ç—å cookie</button>
          <button class="btn ghost" id="btnDeny">–ó–∞–ø—Ä–µ—Ç–∏—Ç—å</button>
          <button class="btn danger" id="btnReset">–°–±—Ä–æ—Å–∏—Ç—å –¥–µ–º–æ</button>
        </div>
      </div>

      <div class="hr"></div>

      <div class="row">
        <label for="category">–ò–Ω—Ç–µ—Ä–µ—Å—ã (—Ä–µ–∫–ª–∞–º–∞):</label>
        <select id="category">
          <option value="travel">–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</option>
          <option value="sport">–°–ø–æ—Ä—Ç</option>
          <option value="tech">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</option>
          <option value="mind">–û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å</option>
        </select>
        <button class="btn" id="btnSave">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—ã–±–æ—Ä</button>
      </div>

      <div class="hr"></div>

      <div class="row">
        <label for="theme">–¢–µ–º–∞ —Å–∞–π—Ç–∞:</label>
        <select id="theme">
          <option value="dark">–¢—ë–º–Ω–∞—è</option>
          <option value="light">–°–≤–µ—Ç–ª–∞—è</option>
        </select>
        <button class="btn" id="btnTheme">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
      </div>

      <p class="kvs">
        –ò—Å–ø–æ–ª—å–∑—É–µ–º: cookie <code>consent</code>, <code>ad_cat</code>, <code>theme</code> (–µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã) –∏
        <code>sessionStorage.ad_cat_ss</code> (–µ—Å–ª–∏ cookie –∑–∞–ø—Ä–µ—â–µ–Ω—ã).
      </p>
    </section>

    <!-- –í–∏—Ç—Ä–∏–Ω–∞ —Ä–µ–∫–ª–∞–º—ã -->
    <section class="card">
      <div class="badge">ü™ß –†–µ–∫–ª–∞–º–Ω—ã–π —Å–ª–æ—Ç</div>
      <div class="ad" id="adSlot"></div>
      <p class="kvs" id="debug"></p>
    </section>
  </div>
</div>

<script>
/* ---------- cookie helpers ---------- */
function setCookie(name, value, days){
  const d = new Date(); d.setTime(d.getTime() + (days*24*60*60*1000));
  const expires = "expires="+ d.toUTCString();
  const secure = location.protocol === "https:" ? "; Secure" : "";
  document.cookie = `${name}=${encodeURIComponent(value)}; ${expires}; path=/; SameSite=Lax${secure}`;
}
function getCookie(name){
  const m = document.cookie.match(new RegExp('(?:^|; )'+name.replace(/([$?*|{}\(\)\[\]\\\/\+^])/g,'\\$1')+'=([^;]*)'));
  return m ? decodeURIComponent(m[1]) : null;
}
function delCookie(name){
  const secure = location.protocol === "https:" ? "; Secure" : "";
  document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/; SameSite=Lax${secure}`;
}

/* ---------- –∫–∞—Ç–∞–ª–æ–≥ —Ä–µ–∫–ª–∞–º—ã ---------- */
const ads = {
  travel:{emoji:"üèùÔ∏è",title:"–¢—É—Ä—ã ‚àí20%",text:"–°—Ç–∞–º–±—É–ª, –¢–±–∏–ª–∏—Å–∏, –î—É–±–∞–π ‚Äî –º–µ—á—Ç—ã —Ä—è–¥–æ–º."},
  sport:{emoji:"üèÉ",title:"–ö—Ä–æ—Å—Å–æ–≤–∫–∏ ProRun",text:"–õ–µ–≥—á–µ –Ω–∞ 30% ‚Äî –±—ã—Å—Ç—Ä–µ–µ –∫–∞–∂–¥—ã–π –∫–º."},
  tech:{emoji:"üíª",title:"Nova 14",text:"–¢–æ–Ω–∫–∏–π, —Ç–∏—Ö–∏–π, 18 —á–∞—Å–æ–≤ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç–∏."},
  mind:{emoji:"üßò",title:"CalmYou",text:"–ú–µ–¥–∏—Ç–∞—Ü–∏–∏ –∏ –¥—ã—Ö–∞–Ω–∏–µ 4‚Äì7‚Äì8."}
};

const el = {
  consent: document.getElementById('consentState'),
  ad: document.getElementById('adSlot'),
  dbg: document.getElementById('debug'),
  cat: document.getElementById('category'),
  theme: document.getElementById('theme')
};

/* ---------- –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–Ω–¥–µ—Ä ---------- */
function getConsent(){ return getCookie('consent'); }

// –≥–¥–µ –±—Ä–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é:
function getAdCat(){
  const consent = getConsent();
  if (consent === '1') return getCookie('ad_cat');             // –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ (cookie)
  return sessionStorage.getItem('ad_cat_ss');                   // –≤ —Ä–∞–º–∫–∞—Ö –≤–∫–ª–∞–¥–∫–∏ (sessionStorage)
}

function setAdCat(value){
  const consent = getConsent();
  if (consent === '1') setCookie('ad_cat', value, 365);
  else sessionStorage.setItem('ad_cat_ss', value);
}

function clearAdCat(){
  delCookie('ad_cat');
  sessionStorage.removeItem('ad_cat_ss');
}

function render(){
  const consent = getConsent();
  const cat = getAdCat();
  const theme = getCookie('theme');

  // —Ç–µ–º–∞: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ consent=1
  const effectiveTheme = (consent==='1' && theme==='light') ? 'light' : 'dark';
  document.body.classList.toggle('light', effectiveTheme==='light');
  el.theme.value = effectiveTheme;

  // —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ–≥–ª–∞—Å–∏—è
  el.consent.textContent = consent==='1' ? '—Ä–∞–∑—Ä–µ—à–µ–Ω–æ' : (consent==='0' ? '–∑–∞–ø—Ä–µ—â–µ–Ω–æ' : '–Ω–µ –∑–∞–¥–∞–Ω–æ');

  // —Ä–µ–∫–ª–∞–º–∞: cookie ‚Üí ad_cat, –∏–Ω–∞—á–µ sessionStorage ‚Üí ad_cat_ss
  if (cat && ads[cat]){
    const a = ads[cat];
    el.ad.innerHTML = `<div><div style="font-size:42px">${a.emoji}</div><h3>${a.title}</h3><p class="muted">${a.text}</p>
      <p class="kvs">–ò—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è: <code>${consent==='1' ? 'cookie: ad_cat' : 'sessionStorage: ad_cat_ss'}</code></p></div>`;
    el.cat.value = cat;
  } else {
    el.ad.innerHTML = `<div><div class="muted">–ù–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏</div><h3>–í—ã –∑–¥–µ—Å—å –≤–ø–µ—Ä–≤—ã–µ?</h3><p class="muted">–ë–µ–∑ –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—â–∏–π –±–∞–Ω–Ω–µ—Ä.</p></div>`;
  }

  // debug-–ø–∞–Ω–µ–ª—å: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏ cookie, –∏ sessionStorage
  el.dbg.textContent = "Cookies: " + (document.cookie || "(–ø—É—Å—Ç–æ)") +
    " | sessionStorage.ad_cat_ss: " + (sessionStorage.getItem('ad_cat_ss') ?? "(–ø—É—Å—Ç–æ)");
}

/* ---------- –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ ---------- */
document.getElementById('btnAllow').onclick = ()=>{
  setCookie('consent','1',365);
  render();
};

document.getElementById('btnDeny').onclick  = ()=>{
  setCookie('consent','0',365);
  clearAdCat();                    // —á–∏—Å—Ç–∏–º –∏ cookie, –∏ sessionStorage –∫–∞—Ç–µ–≥–æ—Ä–∏—é
  delCookie('theme');
  render();
};

document.getElementById('btnSave').onclick  = ()=>{
  const value = el.cat.value;
  setAdCat(value);                 // —Å–æ—Ö—Ä–∞–Ω–∏—Ç –≤ cookie –ò–õ–ò sessionStorage
  render();
};

document.getElementById('btnTheme').onclick = ()=>{
  const value = el.theme.value;
  if (getConsent()==='1') setCookie('theme', value, 365); // —Ç–æ–ª—å–∫–æ —Å cookie
  document.body.classList.toggle('light', value==='light'); // –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ
};

document.getElementById('btnReset').onclick = ()=>{
  ['consent','ad_cat','theme'].forEach(delCookie);
  sessionStorage.removeItem('ad_cat_ss');
  render();
};

render();
</script>
</body>
</html>
